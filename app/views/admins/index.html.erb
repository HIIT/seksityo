<h1>Admin page</h1>

<% if flash[:notify] %>
  <div class="notify" id="notify"><%= flash[:notify] %></div>
<% end %>
<script>
  <!-- Fades the notification out after 5 seconds -->
  $(".notify" ).fadeOut(5000);
</script>

<div class="field-section">
  <h2>Statistics</h2>
  <table class="admin-table">
    <thead>
    <tr>
      <th><%= stat_sort_link "country_code" %></th>
      <th><%= stat_sort_link "created" %></th>
      <th><%= stat_sort_link "confirmed" %></th>
      <th><%= stat_sort_link "alerts_sent" %></th>
      <th><%= stat_sort_link "notifications_sent" %></th>
    </tr>
    </thead>

    <tbody>
    <% @statistics.each do |stat| %>
        <tr>
          <td><%= stat.country_code %></td>
          <td><%= stat.created %></td>
          <td><%= stat.confirmed %></td>
          <td><%= stat.alerts_sent %></td>
          <td><%= stat.notifications_sent %></td>
        </tr>
    <% end %>
    </tbody>
  </table>
</div>

<br>

<div class="field-section">
  <h2>Current meetings</h2>
  <table class="admin-table">
      <thead>
        <th>Nickname</th>
        <th>Safety Contact</th>
        <th><%= meeting_sort_link "created_at", "Created at (UTC)" %></th>
        <th>Time to live</th>
        <th><%= meeting_sort_link "alert_sent", "Alert Sent" %></th>
        <th>Delete</th>
      </thead>
      <tbody>
        <% @meetings.each do |meeting| %>
          <tr>
              <td><%= meeting.nickname %></td>
              <td><%= meeting.phone_number %></td>
              <td><%= meeting.created_at.to_formatted_s(:long_ordinal)  %></td>
              <td><%= meeting.time_to_live %></td>
              <td><%= meeting.alert_sent %></td>
              <td><%= link_to 'Delete', 'admin/delete/'+meeting.id.to_s, method: :delete, :class => 'delete-button', data: { confirm: "Are you sure you want to delete the meeting?"}%>
          </tr>
        <% end %>
      </tbody>
  </table>
</div>
